<div class="chat-room" *ngIf="chatRoom">
    <div class="chat-room-header">
        <div class="header-title">
            <h2>{{ getChatRoomTitle() }}</h2>
            <p class="members">{{ chatRoom.memberUsernames.join(', ') }}</p>
        </div>
        <button (click)="showInviteForm = !showInviteForm" class="btn btn-invite">
            ðŸ‘¥ Invite
        </button>
    </div>

    <div *ngIf="showInviteForm" class="invite-form">
        <form (ngSubmit)="inviteUser()">
            <div class="input-group">
                <input type="text"
                       [(ngModel)]="inviteUsername"
                       name="inviteUsername"
                       placeholder="Enter username to invite..."
                       [disabled]="inviting" />
                <button type="submit" class="btn btn-send" [disabled]="!inviteUsername.trim() || inviting">
                    {{ inviting ? '...' : 'Invite' }}
                </button>
                <button type="button" class="btn btn-cancel" (click)="showInviteForm = false">
                    âœ•
                </button>
            </div>
        </form>
    </div>

    <div class="messages-container" #messagesContainer>
        <div *ngIf="loading" class="loading">
            Loading messages...
        </div>

        <div *ngIf="!loading && messages.length === 0" class="no-messages">
            No messages yet. Start the conversation!
        </div>

        <div *ngFor="let message of messages">

            <!-- SYSTEM MESSAGE -->
            <div *ngIf="isSystemMessage(message)" class="system-message">
                <span class="system-text">{{ message.text }}</span>
                <span class="system-time">{{ message.createdAt | date:'short' }}</span>
            </div>

            <!-- NORMAL MESSAGE -->
            <div *ngIf="!isSystemMessage(message)"
                 class="message"
                 [class.current-user]="isCurrentUserMessage(message)">
                <div class="message-content">
                    <div class="message-header">
                        <strong>{{ message.senderUsername }}</strong>
                        <span class="message-time">{{ message.createdAt | date:'short' }}</span>
                    </div>
                    <p class="message-text">{{ message.text }}</p>
                </div>
            </div>

        </div>

    </div>

    <div class="message-input-container">
        <form (ngSubmit)="sendMessage()">
            <div class="input-group">
                <input type="text"
                       [(ngModel)]="messageText"
                       name="messageText"
                       class="message-input"
                       placeholder="Type your message..."
                       [disabled]="sending" />
                <button type="submit"
                        class="btn btn-send"
                        [disabled]="!messageText.trim() || sending">
                    {{ sending ? '...' : 'Send' }}
                </button>
            </div>
        </form>
    </div>
</div>
